#!/bin/bash
sleep 0.5

APPLICATIONS_TO_CLOSE=("firefox" "gedit" "gnome-terminal" "nautilus" "thunderbird")

# Function to close known applications gracefully and then shutdown the PC in different ways
function _closeall
{
	echo "--- Attempting to gracefully close known applications (SIGTERM) ---"

	# Loop through the list of applications
	for app in "${APPLICATIONS_TO_CLOSE[@]}"; do
		
		# Uses 'pgrep -x' to check if the app is running. 
		# '-x' ensures an exact match of the process name.
		if pgrep -x "$app" > /dev/null; then
			echo "Found and attempting to terminate process: $app..."
			# pkill sends SIGTERM (graceful shutdown) by default.
			pkill "$app"
		else
			echo "$app is not running, skipping."
		fi
	done

	# Waits 3 seconds to allow programs to shut down, save data, and clear memory
	echo "Waiting 3 seconds for graceful termination..."
	sleep 3

	if [[ "$1" == 1 ]]
	then
		systemctl poweroff
	elif [[ "$1" == 2 ]]
	then
		systemctl reboot
	elif [[ "$1" == 3 ]]
	then
		sudo -A dnf5 offline reboot
	fi
}

_closeall "$1" &
